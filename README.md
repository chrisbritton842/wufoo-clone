# RareForm

This is a "lite" clone of the website Wufoo by SurveyMonkey. RareForm allows you to create, edit, view, and share forms with friends and colleagues.

## Getting started
### If you are a mac user using the M1 chip, please follow this setup guide:

1. Install the following containers: [Microsoft Remote - Containers](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers). 
2. Make sure you have [Docker](https://www.docker.com/products/docker-desktop/) installed on your computer. 
3. Open VS Code and Clone only this branch of the repository:
   ```bash
   git clone https://github.com/chrisbritton842/wufoo-clone.git 
   ``` 
4. Click "Open in Container" when VS Code prompts to open container in the bottom right hand corner. This will take some time the first time but will be faster afterwords since much of the process will be cached!

5. Create a `.env` file based on `.env.example` in both the root directory and the *react-app* directory before running the app. 

6. Use the following commands to start your virtual environment (pipenv), migrate your database, seed your database, and run the flask app:

   ```bash
   pipenv shell
   ```
   
   ```bash
   flask db migrate
   ```

   ```bash
   flask db upgrade
   ```

   ```bash
   flask seed all
   ```

   ```bash
   flask run
   ```

7. To run the React App in development, see the following [README](./react-app/README.md) inside the `react-app` directory.

<br>

### If NOT using the M1 chip, follow the steps below:

1. Open VS Code and clone only this branch of the repository:

   ```bash
   git clone https://github.com/chrisbritton842/wufoo-clone.git   ```

2. Install dependencies:

      ```bash
      pipenv install --dev -r dev-requirements.txt && pipenv install -r requirements.txt
      ```

3. Use the `.env.example` to create a `.env` in the root directory using the correct development environment settings.
 
4. Set up your PostgreSQL user, password and database according to your .env settings.

5. Use the following commands to start your virtual environment (pipenv), migrate your database, seed your database, and run the flask app:

   ```bash
   pipenv shell
   ```
   
   ```bash
   flask db migrate
   ```

   ```bash
   flask db upgrade
   ```

   ```bash
   flask seed all
   ```

   ```bash
   flask run
   ```

6. To run the React App in development, see the following [README](./react-app/README.md) inside the `react-app` directory.


## Deployment to Heroku

### Follow these steps to deploy to Heroku:

1. Write your Dockerfile. This application is configured with Github Actions so that Github will automatically pull your code, package, and push it to Heroku. It will then release the new image and run db migrations. Please use the notes notes found in this [docker file](./Dockerfile) to code out the Docker File.

2. It is recommended that you append the following code to your YAML file in .github/workflows so that your seeder files will automatically update when pushing to the main branch:

      ```bash
      - name: Clear Seed Data
        env:
          HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
        run: heroku run -a ${{ secrets.HEROKU_APP_NAME }} flask seed undo

      - name: Seed New Data
        env:
          HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
        run: heroku run -a ${{ secrets.HEROKU_APP_NAME }} flask seed all
        ```
        
3. Make sure you have installed the Heroku Postgres add-on for the application in your Heroku account.

4. Configure the production environment variables in your Heroku app settings. Set a `DATABASE_URL` key to the autogenerated value from the Heroku Postgres add-on. Set a `SECRET_KEY` to a random string.

5. Go to your Github Actions Secrets at the following address: *github.com/userID/repoName/settings/secrets/actions*. Set the key, `HEROKU_API_KEY` to a Heroku Oauth Token. To get the Heroku Oauth Token, run the following command in your terminal already authenticated to the Heroku CLI and pull out the string on the Token key.

   ```bash
   heroku authorizations:create 
   ```
   
 Set the key, `HEROKU_APP_NAME` to the name of the app.
 
 ## Helpful commands
|    Command            |    Purpose    |
| -------------         | ------------- |
| `pipenv shell`        | Open your terminal in the virtual environment and be able to run flask commands without a prefix |
| `pipenv run`          | Run a command from the context of the virtual environment without actually entering into it. You can use this as a prefix for flask commands  |
| `flask db upgrade`    | Check in with the database and run any needed migrations  |
| `flask db downgrade`  | Check in with the database and revert any needed migrations  |
| `flask seed all`      | Just a helpful syntax to run queries against the db to seed data. See the **app/seeds** folder for reference and more details |
| `heroku login -i`      | Authenticate your heroku-cli using the command line. Drop the -i to authenticate via the browser |
| `heroku authorizations:create` | Once authenticated, use this to generate an Oauth token |
| `heroku run -a <app name>` | Run a command from within the deployed container on Heroku |
